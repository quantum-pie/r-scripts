---
title: "Анализ продаж видеоигр на конкурирующих платформах"
author: "Павел Ермаков"
output: 
  html_document:
    toc: yes
    toc_float: yes
urlcolor: blue
---

```{r setup, include=FALSE}
library(ggplot2)
library(dplyr)
library(forcats)
library(tidyr)

knitr::opts_chunk$set(echo = FALSE)
```

## Введение

Данные для исследования взяты из списка наиболее популярных в настоящее время массивов данных на платформе [Kaggle](https://www.kaggle.com)[^1].

[^1]: [Прямая ссылка](https://drive.google.com/file/d/0B_AraRsME-6teGFnOVpORVptZVU/view?usp=sharing) для скачивания данных 

```{r import}
data <- as_data_frame(read.csv("vgsales.csv"))
```

Массив данных содержит сведения о `r nrow(data)` видеоиграх, чьи мировые объемы продаж превысили 100 тысяч копий. 
Сведения собраны за период с `r min(strtoi(data$Year), na.rm=T)` г. по настоящее время и включают в себя следующие интересующие нас переменные:

* Номинативная переменная __Platform__ (игровая платформа) со следующими значениями:

```{r platforms}
levels(data$Platform)
```

* Непрерывная переменная __Global\_Sales__ (мировые продажи), выраженная в миллионах проданных копий.

Более подробно со структурой массива данных можно ознакомиться, взглянув на его первые несколько строчек:

```{r structure}
knitr::kable(head(data, 5), format = "markdown")
```

## Гипотеза

Мы заинтересованы в том, чтобы выяснить, существует ли значительный перевес в долях продаж видеоигр на двух наиболее популярных в настоящее время семействах приставок: __PlayStation__ и __XBox__, а также проследить изменение этого перевеса с течением времени. Для этого будем использовать __R__ версии `r getRversion()`.

Алгоритм работы:

1. Прочитать данные
2. Проанализировать общую динамику продаж:
    + Аггрегировать данные на интересующих приставках
    + Визуализировать
    + Проанализировать результаты
3. Проанализировать динамику соотношения продаж:
    + Вычислить процентное соотношение продаж по семействам приставок
    + Визуализировать
    + Проанализировать результаты
4. Проанализировать соотношение продаж в группах семейство-поколение:
    + Разбить платформы на два фактора: семейство и поколение, аггрегировать данные продаж
    + Визуализировать
    + Проанализировать результаты
5. Сделать общие выводы

## Анализ

### Общая динамика

Для начала посмотрим на динамику продаж по интересущим нас платформам в целом. Мы будем рассматривать все семейство __PlayStation__: __PS__, __PS2__, __PS3__ и __PS4__, а также все семейство __XBox__: __XBox__, __Xbox 360__, __XBox One__. Специфические модели (например, мобильные) не рассматриваются. Аггрегируя соответствующим образом данные, получим таблицу следующего вида:

```{r overall_analysis}
overall_data <- 
  data %>%
  # преобразование строкого представления года в числовое
  mutate(Year = strtoi(Year)) %>%
  # выбор интересующих переменных
  select(Year, Global_Sales, Platform) %>%
  # фильтрация интересующих платформ и удаление данных с неизвестным годом
  filter(Platform %in% c("PS", "PS2", "PS3", "PS4", "XB", "X360", "XOne"), !is.na(Year)) %>%
  group_by(Year, Platform) %>%
  # вычисление годового объема продаж игр по интересующим платформам
  summarize(Total_Sales = sum(Global_Sales)) 

knitr::kable(head(overall_data, 3), caption = "Общая динамика продаж", padding = 0)
```

Визуализируем данные:

```{r plot_1, fig.height=5, fig.width=10}
ggplot(overall_data, aes(Year, Total_Sales))+
  ggtitle("Динамика годовых продаж видеоигр")+
  geom_col(aes(fill = Platform))+
  scale_x_continuous(breaks = seq(1990, 2017, 2), name = "Год")+
  scale_y_continuous(breaks = seq(0, 350, 50), name = "Годовые продажи, миллионов копий")+
  scale_fill_discrete(name = "Платформа")+
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5, size = 14), 
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        legend.title = element_text(size = 12),
        legend.text = element_text(size = 10))
  
```